# üìã RunPod Worker Input/Output Guide

## üîß **Required Input Parameters**

### **For Image Generation:**
```json
{
  "task_type": "text2img",
  "prompt": "A beautiful sunset over mountains",
  "user_id": "firebase-user-uuid-here",
  "file_uid": "generated-file-uuid-here", 
  "use_cloud_storage": true,
  "width": 1024,
  "height": 1024,
  "num_inference_steps": 20,
  "guidance_scale": 7.5
}
```

### **For Video Generation:**
```json
{
  "task_type": "text2video",
  "prompt": "A cat walking in a garden",
  "user_id": "firebase-user-uuid-here",
  "file_uid": "generated-file-uuid-here",
  "use_cloud_storage": true,
  "num_frames": 60
}
```

---

## üéØ **Critical Parameters**

### **Required by Firebase Integration:**
- **`user_id`** ‚úÖ - Firebase user UUID (from Firebase Auth)
- **`file_uid`** ‚úÖ - Unique file identifier (generated by Firebase Function)
- **`use_cloud_storage`** ‚úÖ - Must be `true` to enable cloud storage

### **Critical Routing Parameter:**
- **`task_type`** ‚úÖ - **REQUIRED**: Must be `"text2img"` for images or `"text2video"` for videos

### **Generation Parameters:**
- **`prompt`** ‚úÖ - Text description of what to generate
- **`width`** / **`height`** - Image dimensions (for SDXL: 512-1536px)
- **`num_inference_steps`** - Quality vs speed (10-100, default: 25)
- **`guidance_scale`** - How closely to follow prompt (1-20, default: 7.5)

### **Legacy Parameters (Accepted but Ignored):**
- **`num_images`** - Always generates 1 image (accepted for backward compatibility)

### **Video Specific:**
- **`num_frames`** - Length of video (16-81 frames, only parameter you need to specify)

**Fixed video settings (automatically applied):**
- Resolution: 832x480 (optimized for Wan2.1-1.3B)
- FPS: 15 (standard frame rate)
- Guidance: 5.0 (optimal quality)

> **Note**: Video generation is simplified - you only need to specify `num_frames` for video length. All other video settings (dimensions, FPS, guidance) are automatically set to optimal values.

---

## üì® **Response Examples**

### **üñºÔ∏è Image Generation Response:**
```json
{
  "status": "success",
  "images": [
    "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/user123/image/file456.png"
  ],
  "seed": 1234567890,
  "execution_time": 15.2
}
```

### **üé¨ Video Generation Response:**
```json
{
  "status": "success", 
  "video": "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/user123/video/file789.mp4",
  "seed": 1234567890,
  "execution_time": 45.8
}
```

### **‚ùå Error Response:**
```json
{
  "status": "error",
  "error": "Failed to generate: Invalid prompt",
  "execution_time": 2.1
}
```

---

## üîÑ **Complete Workflow Example**

### **1. Firebase Function Call:**
```javascript
// Firebase Function creates initial document and calls RunPod
const response = await fetch('https://api.runpod.ai/v2/YOUR_ENDPOINT/runsync', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_RUNPOD_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    input: {
      task_type: "text2img",  // Required: specifies image generation
      prompt: "A majestic eagle soaring through clouds",
      user_id: "abc123-def456-ghi789",  // From Firebase Auth
      file_uid: "uuid-generated-here",   // Generated by Firebase Function
      use_cloud_storage: true,
      width: 1024,
      height: 1024,
      num_inference_steps: 25,
      guidance_scale: 8.0
    }
  })
});
```

### **2. Initial Firestore Document (Created by Firebase Function):**
```javascript
// Path: generations/abc123-def456-ghi789/images/uuid-generated-here
{
  status: "queued",
  created_at: "2025-07-22T19:30:00Z",
  request_data: {
    prompt: "A majestic eagle soaring through clouds",
    width: 1024,
    height: 1024,
    // ... other parameters
  },
  file_uid: "uuid-generated-here",
  user_id: "abc123-def456-ghi789"
}
```

### **3. RunPod Processing Updates:**
```javascript
// Document gets updated to:
{
  status: "processing",
  // ... existing fields remain
}
```

### **4. Final Response & Firestore Update:**
```javascript
// RunPod Response:
{
  "status": "success",
  "images": [
    "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here.png"
  ],
  "seed": 1234567890,
  "execution_time": 18.5
}

// Firestore Document becomes:
{
  status: "completed",
  completed_at: "2025-07-22T19:30:18Z",
  generated: true,
  modified: "2025-07-22T19:30:18Z",
  generation_data: {
    image_urls: [
      "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here.png"
    ],
    status: "completed",
    image_count: 1
  },
  // ... original fields remain
}
```

---

## üß™ **Testing Examples**

### **Simple Image Test:**
```json
{
  "task_type": "text2img",
  "prompt": "A red apple on a white table",
  "user_id": "test-user-123",
  "file_uid": "test-file-456", 
  "use_cloud_storage": true,
  "width": 512,
  "height": 512,
  "num_inference_steps": 10
}
```

### **Image Test:**
```json
{
  "task_type": "text2img",
  "prompt": "A cute puppy playing in grass",
  "user_id": "test-user-123",
  "file_uid": "test-file-789",
  "use_cloud_storage": true, 
  "width": 512,
  "height": 512,
  "num_inference_steps": 15
}
```

### **Video Test:**
```json
{
  "task_type": "text2video",
  "prompt": "Ocean waves crashing on beach",
  "user_id": "test-user-123",
  "file_uid": "test-video-101",
  "use_cloud_storage": true,
  "num_frames": 60
}
```

---

## ‚ö†Ô∏è **Important Notes**

### **File Naming:**
- Single image: `{file_uid}.png`
- Videos: `{file_uid}.mp4`

### **Storage Paths:**
- Images: `generating/{user_id}/image/{file_uid}.png`
- Videos: `generating/{user_id}/video/{file_uid}.mp4`

### **Firestore Paths:**
- Images: `generations/{user_id}/images/{file_uid}`
- Videos: `generations/{user_id}/videos/{file_uid}`

### **Fallback Behavior:**
- If Firebase fails, responses will contain base64 data URLs
- Status will still be tracked locally but not in Firestore
- System gracefully degrades to original base64 behavior

---

## üéØ **Quick Test Command:**

```bash
curl -X POST https://api.runpod.ai/v2/YOUR_ENDPOINT/runsync \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "task_type": "text2img",
      "prompt": "A beautiful landscape",
      "user_id": "test-user-123", 
      "file_uid": "test-file-456",
      "use_cloud_storage": true,
      "width": 512,
      "height": 512
    }
  }'
```

This should give you everything you need to test and integrate! üöÄ
