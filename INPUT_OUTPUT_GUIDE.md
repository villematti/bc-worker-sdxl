# 📋 RunPod Worker Input/Output Guide

## 🔧 **Required Input Parameters**

### **For Image Generation:**
```json
{
  "prompt": "A beautiful sunset over mountains",
  "user_id": "firebase-user-uuid-here",
  "file_uid": "generated-file-uuid-here", 
  "use_cloud_storage": true,
  "width": 1024,
  "height": 1024,
  "num_inference_steps": 20,
  "guidance_scale": 7.5,
  "num_images_per_prompt": 1
}
```

### **For Video Generation:**
```json
{
  "prompt": "A cat walking in a garden",
  "user_id": "firebase-user-uuid-here",
  "file_uid": "generated-file-uuid-here",
  "use_cloud_storage": true,
  "width": 512,
  "height": 512,
  "num_frames": 16,
  "fps": 8,
  "num_inference_steps": 20,
  "guidance_scale": 7.5
}
```

---

## 🎯 **Critical Parameters**

### **Required by Firebase Integration:**
- **`user_id`** ✅ - Firebase user UUID (from Firebase Auth)
- **`file_uid`** ✅ - Unique file identifier (generated by Firebase Function)
- **`use_cloud_storage`** ✅ - Must be `true` to enable cloud storage

### **Generation Parameters:**
- **`prompt`** ✅ - Text description of what to generate
- **`width`** / **`height`** - Image/video dimensions
- **`num_inference_steps`** - Quality vs speed (10-50, default: 20)
- **`guidance_scale`** - How closely to follow prompt (1-20, default: 7.5)

### **Image Specific:**
- **`num_images_per_prompt`** - How many images to generate (1-4)

### **Video Specific:**
- **`num_frames`** - Length of video (8-24 frames typical)
- **`fps`** - Frames per second (8-15 typical)

---

## 📨 **Response Examples**

### **🖼️ Image Generation Response:**
```json
{
  "status": "success",
  "images": [
    "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/user123/image/file456.png"
  ],
  "seed": 1234567890,
  "execution_time": 15.2
}
```

### **🎬 Video Generation Response:**
```json
{
  "status": "success", 
  "video": "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/user123/video/file789.mp4",
  "seed": 1234567890,
  "execution_time": 45.8
}
```

### **❌ Error Response:**
```json
{
  "status": "error",
  "error": "Failed to generate: Invalid prompt",
  "execution_time": 2.1
}
```

---

## 🔄 **Complete Workflow Example**

### **1. Firebase Function Call:**
```javascript
// Firebase Function creates initial document and calls RunPod
const response = await fetch('https://api.runpod.ai/v2/YOUR_ENDPOINT/runsync', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_RUNPOD_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    input: {
      prompt: "A majestic eagle soaring through clouds",
      user_id: "abc123-def456-ghi789",  // From Firebase Auth
      file_uid: "uuid-generated-here",   // Generated by Firebase Function
      use_cloud_storage: true,
      width: 1024,
      height: 1024,
      num_inference_steps: 25,
      guidance_scale: 8.0,
      num_images_per_prompt: 2
    }
  })
});
```

### **2. Initial Firestore Document (Created by Firebase Function):**
```javascript
// Path: generations/abc123-def456-ghi789/images/uuid-generated-here
{
  status: "queued",
  created_at: "2025-07-22T19:30:00Z",
  request_data: {
    prompt: "A majestic eagle soaring through clouds",
    width: 1024,
    height: 1024,
    // ... other parameters
  },
  file_uid: "uuid-generated-here",
  user_id: "abc123-def456-ghi789"
}
```

### **3. RunPod Processing Updates:**
```javascript
// Document gets updated to:
{
  status: "processing",
  // ... existing fields remain
}
```

### **4. Final Response & Firestore Update:**
```javascript
// RunPod Response:
{
  "status": "success",
  "images": [
    "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here_0.png",
    "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here_1.png"
  ],
  "seed": 1234567890,
  "execution_time": 18.5
}

// Firestore Document becomes:
{
  status: "completed",
  completed_at: "2025-07-22T19:30:18Z",
  generated: true,
  modified: "2025-07-22T19:30:18Z",
  generation_data: {
    image_urls: [
      "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here_0.png",
      "https://storage.googleapis.com/bc-image-gen.firebasestorage.app/generating/abc123-def456-ghi789/image/uuid-generated-here_1.png"
    ],
    status: "completed",
    image_count: 2
  },
  // ... original fields remain
}
```

---

## 🧪 **Testing Examples**

### **Simple Image Test:**
```json
{
  "prompt": "A red apple on a white table",
  "user_id": "test-user-123",
  "file_uid": "test-file-456", 
  "use_cloud_storage": true,
  "width": 512,
  "height": 512,
  "num_inference_steps": 10
}
```

### **Multiple Images Test:**
```json
{
  "prompt": "A cute puppy playing in grass",
  "user_id": "test-user-123",
  "file_uid": "test-file-789",
  "use_cloud_storage": true, 
  "width": 512,
  "height": 512,
  "num_images_per_prompt": 3,
  "num_inference_steps": 15
}
```

### **Video Test:**
```json
{
  "prompt": "Ocean waves crashing on beach",
  "user_id": "test-user-123",
  "file_uid": "test-video-101",
  "use_cloud_storage": true,
  "width": 512,
  "height": 512,
  "num_frames": 16,
  "fps": 8,
  "num_inference_steps": 20
}
```

---

## ⚠️ **Important Notes**

### **File Naming:**
- Single image: `{file_uid}.png`
- Multiple images: `{file_uid}_0.png`, `{file_uid}_1.png`, etc.
- Videos: `{file_uid}.mp4`

### **Storage Paths:**
- Images: `generating/{user_id}/image/{file_uid}.png`
- Videos: `generating/{user_id}/video/{file_uid}.mp4`

### **Firestore Paths:**
- Images: `generations/{user_id}/images/{file_uid}`
- Videos: `generations/{user_id}/videos/{file_uid}`

### **Fallback Behavior:**
- If Firebase fails, responses will contain base64 data URLs
- Status will still be tracked locally but not in Firestore
- System gracefully degrades to original base64 behavior

---

## 🎯 **Quick Test Command:**

```bash
curl -X POST https://api.runpod.ai/v2/YOUR_ENDPOINT/runsync \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "prompt": "A beautiful landscape",
      "user_id": "test-user-123", 
      "file_uid": "test-file-456",
      "use_cloud_storage": true,
      "width": 512,
      "height": 512
    }
  }'
```

This should give you everything you need to test and integrate! 🚀
